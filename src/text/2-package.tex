\section{Analysis Workflow Overview}
\label{sec:analysis-workflow-overview}
\todo{Regis and Fabio F.}

\subsection{Data access and selection (DL3)}

The analysis of gamma-ray data with Gammapy starts at the Data Level 3 where the data consists
in lists of gamma-like events and their corresponding instrument response functions (IRFs).
The latter include effective area, point spread function (PSF), energy dispersion and
residual hadronic background. In addition there is associated meta data including information
on the observation such as pointing direction, observation time and observation conditions.

\subsection{Data reduction (DL3 to DL4)}

In the next stage of the analysis the user selects a coordinates system, region or
energy binning and events are binned into multidimensional data structures (maps)
with the selected geometry. The instrument response is projected onto the
same geometry as well. At this stage users can select additional background
estimation methods, such as ring background or reflected regions and
exclude parts of the data with high associated IRF systematics by defining
a "safe" data range. The counts data and the reduced IRFs are bundled into
datasets. Those datasets can be optionally grouped and stacked and are
typically written to disk to allow users to read them back at any time later
for modeling and fitting.

\section{Gammapy package}
\label{sec:gammapy-package}

The \gammapy package is structured into multiple sub-packages which mostly
follow the stages in the data reduction workflow.

\subsection{Overview}
\label{ssec:overview}
\begin{figure*}[t]
	\centering
	\includegraphics[width=1.\textwidth]{figures/data_flow.pdf}
	\caption{
		Gammapy sub-package structure and data analysis workflow. }
	\label{fig:data_flow} \end{figure*}

Outline: * List typical analysis use cases * Can use from Python and Jupyter ->
show Figure with Jupyter notebook here. * Gammapy code structure * How Numpy
and Astropy is used

Figures: * Add a Figure showing dataflow in a typical application DL3 at the
top, spectrum, map, lightcurve, fit results at the bottom. Mention major
classes in between (DataStore, EventList, Map, MapMaker, MapFit, â€¦) * Probably
not: Figure showing sub-packages and how they relate (gammapy.data and
gammapy.irf at the base, then gammapy.maps, etc. * The code example Figure how
to make a counts map, to explain how the package works.

\todo{How to sort the sub-packages? After data flow or alphabetically? What
	about maps?}
\input{text/2-package-subsections/data}
\input{text/2-package-subsections/irf}
\input{text/2-package-subsections/maps}
\input{text/2-package-subsections/makers}
\input{text/2-package-subsections/datasets}
\input{text/2-package-subsections/modeling}
\input{text/2-package-subsections/stats}
\input{text/2-package-subsections/estimators}
\input{text/2-package-subsections/analysis}
\input{text/2-package-subsections/visualisation}
\input{text/2-package-subsections/astro}
\input{text/2-package-subsections/catalog}
\input{text/2-package-subsections/utils}
